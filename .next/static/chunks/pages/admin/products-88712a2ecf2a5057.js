(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{6273:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/products",function(){return a(6842)}])},6842:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSP:function(){return d},default:function(){return AdminProducts}});var s=a(5893),l=a(7294),n=a(7066);function ProductForm(e){var t;let{product:a,onSaved:d}=e,[i,c]=(0,l.useState)((null==a?void 0:a.title)||""),[r,o]=(0,l.useState)((null==a?void 0:a.slug)||""),[u,m]=(0,l.useState)((null==a?void 0:a.price)?a.price/100:0),[p,x]=(0,l.useState)((null==a?void 0:a.images)||[]),[h,v]=(0,l.useState)((null==a?void 0:a.description)||""),[f,b]=(0,l.useState)(null===(t=null==a?void 0:a.inStock)||void 0===t||t);async function upload(e){let t=new FormData;t.append("file",e);let a=await n.Z.post("/api/admin/upload",t,{headers:{"Content-Type":"multipart/form-data"}});return a.data.url}async function handleFile(e){let t=await upload(e.target.files[0]);x(e=>[...e,t])}function removeImage(e){x(t=>t.filter(t=>t!==e))}async function handleSubmit(e){e.preventDefault();let t={title:i,slug:r,description:h,price:Math.round(100*Number(u)),images:p,inStock:f};a?await n.Z.put("/api/products/".concat(a.id),t):await n.Z.post("/api/products",t),null==d||d()}return(0,s.jsxs)("form",{onSubmit:handleSubmit,className:"space-y-4",children:[(0,s.jsx)("input",{value:i,onChange:e=>c(e.target.value),placeholder:"Title",className:"w-full p-2 border rounded"}),(0,s.jsx)("input",{value:r,onChange:e=>o(e.target.value),placeholder:"Slug",className:"w-full p-2 border rounded"}),(0,s.jsx)("input",{value:u,onChange:e=>m(e.target.value),placeholder:"Price (INR)",type:"number",className:"w-full p-2 border rounded"}),(0,s.jsx)("textarea",{value:h,onChange:e=>v(e.target.value),placeholder:"Description",className:"w-full p-2 border rounded"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm mb-1",children:"Images"}),(0,s.jsx)("input",{type:"file",onChange:handleFile}),(0,s.jsx)("div",{className:"flex gap-2 mt-2 flex-wrap",children:p.map((e,t)=>(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:e,className:"w-20 h-20 object-cover rounded"}),(0,s.jsx)("button",{type:"button",onClick:()=>removeImage(e),className:"absolute -top-2 -right-2 bg-white rounded-full p-1 text-xs border",children:"\xd7"})]},t))})]}),(0,s.jsx)("div",{className:"flex items-center gap-3",children:(0,s.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:f,onChange:e=>b(e.target.checked)}),(0,s.jsx)("span",{children:"In stock"})]})}),(0,s.jsx)("button",{className:"px-4 py-2 bg-black text-white rounded",children:"Save"})]})}var d=!0;function AdminProducts(){let[e,t]=(0,l.useState)([]),[a,d]=(0,l.useState)(null);async function load(){let e=await n.Z.get("/api/products");t(e.data)}return(0,l.useEffect)(()=>{load()},[]),(0,s.jsxs)("div",{className:"max-w-5xl mx-auto p-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Products"}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold mb-2",children:"Create / Edit"}),(0,s.jsx)(ProductForm,{product:a,onSaved:()=>{d(null),load()}})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"font-semibold mb-2",children:"All products"}),(0,s.jsx)("div",{className:"space-y-3",children:e.map(e=>{var t;return(0,s.jsxs)("div",{className:"border p-3 rounded flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("img",{src:null===(t=e.images)||void 0===t?void 0:t[0],className:"w-20 h-20 object-cover rounded"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-semibold",children:e.title}),(0,s.jsxs)("div",{className:"text-sm",children:["â‚¹",(e.price/100).toFixed(2)]}),(0,s.jsx)("div",{className:"text-sm",children:e.inStock?"In stock":"Out of stock"})]})]}),(0,s.jsxs)("div",{className:"space-x-2",children:[(0,s.jsx)("button",{onClick:()=>d(e),className:"px-3 py-1 border rounded",children:"Edit"}),(0,s.jsx)("button",{onClick:async()=>{await n.Z.delete("/api/products/".concat(e.id)),load()},className:"px-3 py-1 border rounded",children:"Delete"})]})]},e.id)})})]})]})]})}}},function(e){e.O(0,[66,774,888,179],function(){return e(e.s=6273)}),_N_E=e.O()}]);